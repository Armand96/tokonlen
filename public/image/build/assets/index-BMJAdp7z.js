import{r as m,j as t,J as T}from"./remixicon-C_NSdncx.js";import{P as U}from"./PageBreadcrumb-DMS3BnLo.js";import{H as y}from"./HelpersFunction-CKAZVPIR.js";import{M as V,T as B}from"./tablePaginate-BAhHNbsP.js";import{L as q}from"./loading-CQIiW4Pw.js";import{F as f}from"./FormInput-BoSlL2Nr.js";import{S as G}from"./react-select.esm-CUcxdhLx.js";import{a as C}from"./products-C7-IbQHC.js";import{e as J,G as L,P as w}from"./discounts-DX0PRXKO.js";import{d as v}from"./dayjs.min-DUnApQFb.js";import"./dialog-YCz78_fl.js";import"./transition-B_aZ0yjS.js";import"./floating-ui.dom-DmIclXt_.js";const K=({isOpen:N,toggleModal:b,isCreate:g,detailData:x,setLoading:h,reloadData:S})=>{const[a,l]=m.useState({discount_by:0,is_by_product:0,start_date:v().format("YYYY-MM-DD"),end_date:v().format("YYYY-MM-DD"),is_active:1,discount_percentage:0,discount_amount:0}),[p,k]=m.useState(),[c,j]=m.useState({label:"",value:0});m.useEffect(()=>{g||J(`/${x==null?void 0:x.id}`).then(e=>{var i,o,u,s,n,d,r,Y,E,F,O,P,I,A,R,$,z,H;l({...a,...e==null?void 0:e.data,is_by_product:(i=e==null?void 0:e.data)!=null&&i.product?1:2,discount_by:((o=e==null?void 0:e.data)==null?void 0:o.discount_percentage)>0?1:2,start_date:v((u=e==null?void 0:e.data)==null?void 0:u.start_date).format("YYYY-MM-DD"),end_date:v((s=e==null?void 0:e.data)==null?void 0:s.end_date).format("YYYY-MM-DD")}),(n=e==null?void 0:e.data)!=null&&n.product?j({value:(r=(d=e==null?void 0:e.data)==null?void 0:d.product)==null?void 0:r.id,label:(E=(Y=e==null?void 0:e.data)==null?void 0:Y.product)==null?void 0:E.name}):j({value:(O=(F=e==null?void 0:e.data)==null?void 0:F.variant)==null?void 0:O.id,label:`${(I=(P=e==null?void 0:e.data)==null?void 0:P.variant)==null?void 0:I.variant} - ${($=(R=(A=e==null?void 0:e.data)==null?void 0:A.variant)==null?void 0:R.product)==null?void 0:$.name} -  ${(H=(z=e==null?void 0:e.data)==null?void 0:z.variant)==null?void 0:H.size} `})})},[x]);const _=async(e=a==null?void 0:a.is_by_product,i=a==null?void 0:a.discount_by)=>{try{if(e!==0&&i!==0){const o=e===1?C:L,u=e===1?"name":"variant",s=await o("?is_active=1&data_per_page=999999");k(e===1?y.FormatOptions(s.data,u,"id"):y.FormatOptionsVariants(s.data,u,"id")),j({label:"",value:0})}l({...a,discount_percentage:0,discount_amount:0,is_by_product:e,discount_by:i})}catch(o){console.error("Error fetching data:",o)}},M=async()=>{h(!0),(a==null?void 0:a.is_by_product)===1?await C(`/${c==null?void 0:c.value}`).then(i=>{var o,u,s,n,d,r;(u=(o=i==null?void 0:i.data)==null?void 0:o.discount)!=null&&u.id&&((n=(s=i==null?void 0:i.data)==null?void 0:s.discount)==null?void 0:n.id)!==(a==null?void 0:a.id)&&w({_method:"DELETE"},(r=(d=i==null?void 0:i.data)==null?void 0:d.discount)==null?void 0:r.id)}):await L(`/${c==null?void 0:c.value}`).then(i=>{var o,u,s,n,d,r;(u=(o=i==null?void 0:i.data)==null?void 0:o.discount)!=null&&u.id&&((n=(s=i==null?void 0:i.data)==null?void 0:s.discount)==null?void 0:n.id)!==(a==null?void 0:a.id)&&w({_method:"DELETE"},(r=(d=i==null?void 0:i.data)==null?void 0:d.discount)==null?void 0:r.id)});let e={product_id:(a==null?void 0:a.is_by_product)==1?c==null?void 0:c.value:0,variant_id:(a==null?void 0:a.is_by_product)==2?c==null?void 0:c.value:0,discount_percentage:(a==null?void 0:a.discount_by)==1?a==null?void 0:a.discount_percentage:"0",discount_amount:(a==null?void 0:a.discount_by)==2?a==null?void 0:a.discount_amount:"0",start_date:a==null?void 0:a.start_date,end_date:a==null?void 0:a.end_date,_method:g?"POST":"PUT"};await w(e,a==null?void 0:a.id).then(i=>{b(),T.fire("Success",g?"Input Discount berhasil":"Edit Discount berhasil","success"),S(),h(!1)}).catch(i=>{console.log(i),T.fire("Error",i||"Terjadi kesalahan","error"),h(!1)})};return t.jsx(V,{showModal:N,toggleModal:()=>b(),placement:"justify-center items-start",children:t.jsxs("div",{className:"m-3 sm:mx-auto flex flex-col bg-white shadow-sm rounded",children:[t.jsxs("div",{className:"flex justify-between items-center py-2.5 px-4 border-b",children:[t.jsx("h3",{className:"text-lg",children:g?"Tambah Data":"Edit Data"}),t.jsx("button",{className:"h-8 w-8",onClick:()=>b(),children:t.jsx("i",{className:"ri-close-line text-2xl"})})]}),t.jsxs("div",{className:"p-4 overflow-y-auto  w-[70vw]",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{className:"text-sm mb-2",children:"Dipasang pada"}),t.jsxs("div",{className:"flex gap-5",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio",id:"produk",onChange:()=>{l({...a,is_by_product:1}),_(1,void 0)},checked:a.is_by_product==1}),t.jsx("label",{className:"ms-1.5",htmlFor:"produk",children:"produk"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio",id:"variant",onChange:()=>{l({...a,is_by_product:2}),_(2,void 0)},checked:a.is_by_product==2}),t.jsx("label",{className:"ms-1.5",htmlFor:"variant",children:"variant"})]})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{className:"text-sm mb-2",children:"diskon berdasarkan"}),t.jsxs("div",{className:"flex gap-5",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio2",id:"persentase",onChange:()=>{l({...a,discount_by:1}),_(void 0,1)},checked:(a==null?void 0:a.discount_by)==1}),t.jsx("label",{className:"ms-1.5",htmlFor:"persentase",children:"Presentase"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio2",id:"harga",onChange:()=>{l({...a,discount_by:2}),_(void 0,2)},checked:(a==null?void 0:a.discount_by)==2}),t.jsx("label",{className:"ms-1.5",htmlFor:"harga",children:"Harga"})]})]})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"mb-2",htmlFor:"choices-text-remove-button",children:"Produk / variant"}),t.jsx(G,{isDisabled:(a==null?void 0:a.is_by_product)==0||(a==null?void 0:a.discount_by)==0,className:"select2 z-5",options:p,value:c,onChange:e=>j(e)})]}),(a==null?void 0:a.discount_by)==1&&t.jsx(f,{name:"name",label:"persentase",value:a==null?void 0:a.discount_percentage,onChange:e=>l({...a,discount_percentage:parseInt(e.target.value)>100?100:e.target.value}),className:"form-input mb-3"}),(a==null?void 0:a.discount_by)==2&&t.jsx(f,{name:"name",label:"Harga",value:y.FormatToRupiah2(parseInt(a==null?void 0:a.discount_amount)||0),onChange:e=>l({...a,discount_amount:parseInt(y.onlyNumber(e.target.value))}),className:"form-input mb-3"}),t.jsx("div",{className:"mb-3",children:t.jsx(f,{label:"Tanggal Mulai",type:"date",name:"Tanggal Mulai",containerClass:"mb-3",labelClassName:"mb-2",className:"form-input",value:a==null?void 0:a.start_date,onChange:e=>l({...a,start_date:v(e.target.value).format("YYYY-MM-DD")})},"Tanggal Mulai")}),t.jsx("div",{className:"mb-3",children:t.jsx(f,{label:"Tanggal Akhir",type:"date",name:"Tanggal Akhir",containerClass:"mb-3",labelClassName:"mb-2",className:"form-input",value:a==null?void 0:a.end_date,onChange:e=>l({...a,end_date:v(e.target.value).format("YYYY-MM-DD")})},"Tanggal Akhir")}),!g&&t.jsxs("div",{className:"mb-2",children:[t.jsx("h6",{className:"text-sm mb-2",children:"Status"}),t.jsx("input",{type:"checkbox",checked:a.is_active===1,onChange:e=>l({...a,is_active:e.target.checked?1:0})}),t.jsx("label",{className:"ml-2",children:"Aktif"})]})]}),t.jsxs("div",{className:"flex justify-end p-4 border-t gap-x-4",children:[t.jsx("button",{className:"btn bg-light text-gray-800",onClick:()=>b(),children:"Close"}),t.jsx("button",{className:"btn bg-primary text-white",onClick:M,children:"Submit"})]})]})})},la=()=>{const[N,b]=m.useState(!1),[g,x]=m.useState(!1),[h,S]=m.useState(),[a,l]=m.useState(!1),[p,k]=m.useState(null),[c,j]=m.useState(),[_,M]=m.useState(),e=async(s=1,n=_==null?void 0:_.label)=>{x(!0);const d={page:s,product_name:n},r=new URLSearchParams(JSON.parse(JSON.stringify(d))).toString(),Y=await J(`?${r}`);k(Y),x(!1)};m.useEffect(()=>{Promise.all([e(),C("?data_per_page=99999&is_active=1")]).then(s=>{var n;j([...y.FormatOptions((n=s[1])==null?void 0:n.data,"name","id"),{label:"Semua",value:""}])})},[]);const i=async()=>{x(!0);const s={...h,_method:h.id?"PUT":"POST"};await w(s,h==null?void 0:h.id),await e(),b(!1),T.fire("Success",h.id?"Edit Diskon berhasil":"Input Diskon berhasil","success")},o=[{name:"Produk",row:s=>{var n,d,r;return t.jsx("div",{children:((n=s.product)==null?void 0:n.name)||((r=(d=s==null?void 0:s.variant)==null?void 0:d.product)==null?void 0:r.name)})}},{name:"Variant",row:s=>{var n,d;return t.jsxs("div",{children:[(n=s==null?void 0:s.variant)==null?void 0:n.variant," - ",(d=s==null?void 0:s.variant)==null?void 0:d.size]})}},{name:"Persen",row:s=>t.jsx("div",{children:s.discount_percentage})},{name:"Harga",row:s=>t.jsx("div",{children:y.FormatToRupiah(s.discount_amount)})},{name:"Tanggal Awal",row:s=>t.jsx("div",{children:v(s.start_date).format("DD MMM YYYY")})},{name:"Tanggal Akhir",row:s=>t.jsx("div",{children:v(s.end_date).format("DD MMM YYYY")})},{name:"Status",row:s=>t.jsx("div",{children:v().isAfter(s.end_date,"milliseconds")?"Expired":"Active"})},{name:"Action",row:s=>t.jsx("button",{className:"btn bg-primary text-white",onClick:()=>{b(!0),S(s),l(!1)},children:"Edit"})}],u=s=>{x(!0),M(s),e(0,s.label=="Semua"?void 0:s.label)};return t.jsxs(t.Fragment,{children:[g&&t.jsx(q,{}),N&&t.jsx(K,{reloadData:e,setLoading:x,isCreate:a,toggleModal:()=>b(!1),isOpen:N,handlePost:i,detailData:h}),t.jsx(U,{title:"discount",subName:"Backoffice"}),t.jsxs("div",{className:"bg-white p-4 ",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("h3",{className:"text-2xl font-bold",children:"Discounts"}),t.jsx("button",{className:"btn bg-primary mb-4 text-white",onClick:()=>{b(!0),l(!0),S({name:"",format_size:"",is_active:1})},children:"Tambah Data"})]}),t.jsx("h3",{className:"text-lg mb-2",children:"Search"}),t.jsx("div",{className:"mb-3 bg-gray-50 px-4 py-6 flex ",children:t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsx("label",{className:"mb-2",htmlFor:"choices-text-remove-button",children:"Product"}),t.jsx(G,{className:"select2 z-5",options:c,onChange:s=>u(s),value:_})]})}),t.jsxs("p",{className:"mb-2",children:["Total Data : ",p==null?void 0:p.total]}),t.jsx(B,{totalPage:(p==null?void 0:p.last_page)||0,data:p==null?void 0:p.data,columns:o,onPageChange:s=>e(s.selected+1)})]})]})};export{la as default};
