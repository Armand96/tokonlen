import{r as o,j as e,J as N}from"./remixicon-C_NSdncx.js";import{P as L}from"./PageBreadcrumb-DMS3BnLo.js";import{H as S}from"./HelpersFunction-CKAZVPIR.js";import{M as Y,T as K}from"./tablePaginate-BAhHNbsP.js";import{L as Q}from"./loading-CQIiW4Pw.js";import{F as A}from"./FormInput-BoSlL2Nr.js";import{F as W}from"./index-O_58Jj6h.js";import{S as $}from"./react-select.esm-CUcxdhLx.js";import{a as P}from"./products-C7-IbQHC.js";import{G as X}from"./size-C9c9zRPv.js";import{c as U}from"./index-iADm5Rez.js";import{G as H,P as G,a as Z,b as M,c as q,d as D}from"./discounts-DX0PRXKO.js";import"./dialog-YCz78_fl.js";import"./transition-B_aZ0yjS.js";import"./floating-ui.dom-DmIclXt_.js";const aa=({isOpen:y,toggleModal:p,isCreate:v,detailData:x,reloadData:b,setLoading:m})=>{const[a,u]=o.useState({additional_price:0,is_active:1}),[d,F]=o.useState([]),[w,k]=o.useState([]),[_,T]=o.useState(),[n,E]=o.useState(),[f,I]=o.useState([]),[t,j]=o.useState();o.useEffect(()=>{m(!0),Promise.all([X("?data_per_page=99999&is_active=1"),P("?data_per_page=99999&is_active=1")]).then(s=>{var c,i;j((c=s[0])==null?void 0:c.data),T(S.FormatOptions((i=s[1])==null?void 0:i.data,"name","id")),v?m(!1):H(`/${x==null?void 0:x.id}`).then(r=>{var l;E({value:r.data.product.id,label:r.data.product.name}),k((l=r==null?void 0:r.data)==null?void 0:l.images),u({...a,...r.data}),m(!1)})})},[]);const V=async()=>{var c;let s=f.map(i=>({variant:a==null?void 0:a.variant,size:i,product_id:n==null?void 0:n.value,additional_price:(a==null?void 0:a.additional_price)||0,is_active:a==null?void 0:a.is_active,stock:a==null?void 0:a.stock}));try{m(!0),await P(`/${n==null?void 0:n.value}`).then(l=>{var h,g,z,R;(g=(h=l==null?void 0:l.data)==null?void 0:h.discount)!=null&&g.id&&G({_method:"DELETE"},(R=(z=l==null?void 0:l.data)==null?void 0:z.discount)==null?void 0:R.id)});let i;i=await Z({variants:s});let r=i.data.data.map(l=>l.id);if(((c=a.image_files)==null?void 0:c.length)>0){const l=r.map(async h=>{for(const g of Array.from(a.image_files))await new Promise(z=>{setTimeout(async()=>{await M({variant_id:h,image_file:g}),z(null)},1e3)})});await Promise.all(l)}p(),N.fire("Success","Input Variant berhasil","success"),b()}catch(i){N.fire("Error",i.message||"Terjadi kesalahan","error")}finally{m(!1)}},C=async()=>{var s;m(!0);try{const c={variant:a==null?void 0:a.variant,product_id:n==null?void 0:n.value,additional_price:a==null?void 0:a.additional_price,is_active:a==null?void 0:a.is_active,stock:a==null?void 0:a.stock,size:a==null?void 0:a.size,id:a==null?void 0:a.id,_method:"PUT"};await P(`/${a==null?void 0:a.product_id}`).then(i=>{var r,l,h,g;(l=(r=i==null?void 0:i.data)==null?void 0:r.discount)!=null&&l.id&&G({_method:"DELETE"},(g=(h=i==null?void 0:i.data)==null?void 0:h.discount)==null?void 0:g.id)}),await q(c,a==null?void 0:a.id),d.length>0&&await D({_method:"DELETE",ids:d}),((s=a.image_files)==null?void 0:s.length)>0&&await(async()=>{for(const r of Array.from(a.image_files))await new Promise(l=>{setTimeout(async()=>{await M({variant_id:a==null?void 0:a.id,image_file:r}),l(null)},1e3)})})(),p(),N.fire("Success","Edit Variant berhasil","success"),b(),m(!1)}catch(c){N.fire("Error",c.message||"Terjadi kesalahan","error"),m(!1)}},O=s=>{let c=[];s.forEach(i=>{c.push(i)}),u({...a,image_files:c})},B=s=>{let c=U(a.image_files);c.splice(s,1),u({...a,image_files:c})},J=(s,c)=>{let i=U(w);i.splice(c,1),k(i),F([...d,s])};return e.jsx(Y,{showModal:y,toggleModal:()=>p(),placement:"justify-center items-start",children:e.jsxs("div",{className:"m-3 sm:mx-auto flex flex-col bg-white shadow-sm rounded",children:[e.jsxs("div",{className:"flex justify-between items-center py-2.5 px-4 border-b",children:[e.jsx("h3",{className:"text-lg",children:v?"Tambah Data":"Edit Data"}),e.jsx("button",{className:"h-8 w-8",onClick:()=>p(),children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto w-[70vw]",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"mb-2",htmlFor:"choices-text-remove-button",children:"Product"}),e.jsx($,{isDisabled:!v,className:"select2 z-5",options:_,onChange:s=>E(s),value:n})]}),e.jsx(A,{name:"variant",label:"Nama Variant",value:a.variant,onChange:s=>u({...a,variant:s.target.value}),className:"form-input mb-3"}),e.jsx(A,{labelClassName:"mb-2",name:"additional_price",label:"Harga Tambahan",value:S.FormatToRupiah2((a==null?void 0:a.additional_price)||0),onChange:s=>u({...a,additional_price:parseInt(S.onlyNumber(s.target.value))}),className:"form-input mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"text-sm mb-2",children:"Variant Tersedia ?"}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio",id:"InlineRadio01",onChange:()=>u({...a,stock:1}),checked:(a==null?void 0:a.stock)===1}),e.jsx("label",{className:"ms-1.5",htmlFor:"InlineRadio01",children:"Ya"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-primary",name:"InlineRadio",id:"InlineRadio02",onChange:()=>u({...a,stock:0}),checked:(a==null?void 0:a.stock)===0}),e.jsx("label",{className:"ms-1.5",htmlFor:"InlineRadio02",children:"tidak"})]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h6",{className:"text-sm mb-2",children:"Variant Ukuran"}),t==null?void 0:t.map((s,c)=>{var i,r,l;return e.jsxs("div",{className:"",children:[e.jsx("input",{type:"checkbox",disabled:!v||((l=(r=(i=n==null?void 0:n.detail)==null?void 0:i.variant)==null?void 0:r.flatMap(h=>h.size))==null?void 0:l.includes(s==null?void 0:s.format_size)),checked:v?f.includes((s==null?void 0:s.format_size)||(a==null?void 0:a.size)):(s==null?void 0:s.format_size)==a.size,onClick:()=>f.includes(s==null?void 0:s.format_size)?I([...f.filter(h=>h!==(s==null?void 0:s.format_size)||(s==null?void 0:s.size))]):I([...f,s==null?void 0:s.format_size])}),e.jsx("label",{className:"ml-2",children:s==null?void 0:s.format_size})]},c)})]}),!v&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h6",{className:"text-sm mb-2",children:"Status"}),e.jsx("input",{type:"checkbox",checked:a.is_active===1,onChange:s=>u({...a,is_active:s.target.checked?1:0})}),e.jsx("label",{className:"ml-2",children:"Aktif"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"choices-text-remove-button",children:"Upload Image"}),e.jsx(W,{onFileDelete:B,detailData:x,handleDeletePrevImage:J,prevData:w,maxSizeParms:2,onFileUpload:O,icon:"ri-upload-cloud-line text-4xl text-gray-300 dark:text-gray-200",text:" klik untuk upload. "})]})]}),e.jsxs("div",{className:"flex justify-end p-4 border-t gap-x-4",children:[e.jsx("button",{className:"btn bg-light text-gray-800",onClick:()=>p(),children:"Close"}),e.jsx("button",{className:"btn bg-primary text-white",onClick:()=>v?V():C(),children:"Submit"})]})]})})},ba=()=>{const[y,p]=o.useState(!1),[v,x]=o.useState(!1),[b,m]=o.useState(),[a,u]=o.useState(!1),[d,F]=o.useState(null),[w,k]=o.useState(),[_,T]=o.useState(),n=async(t=0,j=_==null?void 0:_.label)=>{x(!0);const V={page:t,product_name:j},C=new URLSearchParams(JSON.parse(JSON.stringify(V))).toString(),O=await H(`?${C}`);F(O),x(!1)};o.useEffect(()=>{Promise.all([n(),P("?data_per_page=99999&is_active=1")]).then(t=>{var j;k([...S.FormatOptions((j=t[1])==null?void 0:j.data,"name","id"),{label:"Semua",value:""}])})},[]);const E=async()=>{x(!0);const t={...b,_method:b.id?"PUT":"POST"};await q(t,b==null?void 0:b.id),await n(),p(!1),N.fire("Success",b.id?"Edit Variants berhasil":"Input Variants berhasil","success")},f=[{name:"Nama Produk",row:t=>{var j;return e.jsx("div",{children:(j=t==null?void 0:t.product)==null?void 0:j.name})}},{name:"Nama Variants",row:t=>e.jsx("div",{children:t.variant})},{name:"Ukuran Variants",row:t=>e.jsx("div",{children:t.size})},{name:"Harga Tambahan",row:t=>e.jsx("div",{children:S.FormatToRupiah(t.additional_price)})},{name:"Status",row:t=>e.jsx("div",{children:t.is_active?"Active":"Non Active"})},{name:"Action",row:t=>e.jsx("button",{className:"btn bg-primary text-white",onClick:()=>{p(!0),m(t),u(!1)},children:"Edit"})}],I=t=>{x(!0),T(t),n(0,t.label=="Semua"?void 0:t.label)};return e.jsxs(e.Fragment,{children:[v&&e.jsx(Q,{}),y&&e.jsx(aa,{reloadData:n,setLoading:x,isCreate:a,toggleModal:()=>p(!1),isOpen:y,handlePost:E,detailData:b}),e.jsx(L,{title:"Variants",subName:"Backoffice"}),e.jsxs("div",{className:"bg-white p-4 ",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Variants"}),e.jsx("button",{className:"btn bg-primary mb-4 text-white",onClick:()=>{p(!0),u(!0),m({name:"",format_size:"",is_active:1})},children:"Tambah Data"})]}),e.jsx("h3",{className:"text-lg mb-2",children:"Search"}),e.jsx("div",{className:"mb-3 bg-gray-50 px-4 py-6 flex ",children:e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-2",htmlFor:"choices-text-remove-button",children:"Product"}),e.jsx($,{className:"select2 z-5",options:w,onChange:t=>I(t),value:_})]})}),e.jsxs("p",{className:"mb-2",children:["Total Data : ",d==null?void 0:d.total]}),e.jsx(K,{totalPage:(d==null?void 0:d.last_page)||0,data:d==null?void 0:d.data,columns:f,onPageChange:t=>n(t.selected)})]})]})};export{ba as default};
